---
description: KhÃ¡i niá»‡m cÄƒn báº£n vá» promise trong javascript
---

# 1. Promise Javascript

## I. Promise lÃ  gÃ¬?

Promise lÃ  má»™t cÆ¡ cháº¿ trong JavaScript giÃºp báº¡n thá»±c thi cÃ¡c tÃ¡c vá»¥ báº¥t Ä‘á»“ng bá»™ mÃ  khÃ´ng rÆ¡i vÃ o callback hell hay pyramid of doom, lÃ  tÃ¬nh tráº¡ng cÃ¡c hÃ m callback lá»“ng vÃ o nhau á»Ÿ quÃ¡ nhiá»u táº§ng



**Promise state javascript** 

* Fulfilled â€“ Khi promise resolved successfully. 
* Rejected â€“ Khi promise failed. 
* Pending â€“ Khi promise Ä‘ang chá» tráº£ vá» Fulfilled or Rejected. 
* Settled â€“ Thuáº­t ngá»¯ nÃ y dÃ¹ng Ä‘á»ƒ mÃ´ táº£ cho method má»›i cÃ³ láº½ sáº¯p ra máº¯t

## II. VÃ­ dá»¥ promise

### 1. Promise.all vs Promise.allSettled

*  **Promise.all** duyá»‡t háº¿t nhÆ°ng return ngay khi má»™t Promise nÃ o Ä‘Ã³ return vá» Rejected 
*  **Promise.allSettled** duyá»‡t háº¿t vÃ  return ngay cáº£ khi má»™t Promise nÃ o Ä‘Ã³ return vá» Rejected

#### - Promise.all

```javascript
const promisesWithoutReject = [
  Promise.resolve('ğŸ #1'),
  'ğŸ #2',
  new Promise((resolve, reject) => setTimeout(resolve, 100, 'ğŸ #3'))
]

Promise.all(promisesWithoutReject)
  .then(apples => console.log(`We can sell all these good apples`, apples))


const promisesWithOneReject = [
  Promise.resolve('ğŸ #1'),
  'ğŸ #2',
  new Promise((_, reject) => setTimeout(reject, 100, 'Bad ğŸ'))
]

Promise.all(promisesWithOneReject)
  .then(console.log)
  .catch(badApple => 
    console.error(`Threw out all apples because of this`, badApple))
```

Output:

```javascript
We can sell all these good apples [ 'ğŸ #1', 'ğŸ #2', 'ğŸ #3' ]
Threw out all apples because of this Bad ğŸ
```

#### - Promise.allSettled

```javascript
const allRejectedPromises = [
  Promise.reject('ğŸ #1'),
  Promise.reject('ğŸ #2'),
  Promise.reject('ğŸ #3'),
]

Promise.allSettled(allRejectedPromises)
  .then(badApples => 
    console.log(`We can't sell any of these apples...`, badApples))
  .catch(error => console.error('This should never occur'))


const promisesWithoutReject = [
  Promise.resolve('ğŸ #1'),
  'ğŸ #2',
  new Promise((resolve, reject) => setTimeout(resolve, 100, 'ğŸ #3'))
]

Promise.allSettled(promisesWithoutReject)
  .then(apples => console.log(`We can sell all these good apples`, apples.map(_=>_.value)))


const promisesWithOneReject = [
  Promise.resolve('ğŸ #1'),
  new Promise((_, reject) => setTimeout(reject, 10, 'ğŸ #2')),
  'ğŸ #3',
  new Promise((_, reject) => setTimeout(reject, 100, 'ğŸ #4'))
]

const extractApples = apples => apples.map(_ => _.value)
Promise.allSettled(promisesWithOneReject)
  .then(apples => {
    const badApples = apples.filter(apple => apple.status === 'rejected').map(_ => _.reason)
    const goodApples = apples.filter(apple => apple.status === 'fulfilled').map(_ => _.value)

    console.log(`Let's throw out`, badApples, `and sell the rest`, goodApples)
  })
```

Output:

```javascript
We can't sell any of these apples... 
[ { status: 'rejected', reason: 'ğŸ #1' },
  { status: 'rejected', reason: 'ğŸ #2' },
  { status: 'rejected', reason: 'ğŸ #3' } ]
We can sell all these good apples [ 'ğŸ #1', 'ğŸ #2', 'ğŸ #3' ]
Let's throw out [ 'ğŸ #2', 'ğŸ #4' ] and sell the rest [ 'ğŸ #1', 'ğŸ #3' ]
```

### 2. Promise.race vs Promise.any

*  **Promise.race** return ngay khi má»™t Promise Ä‘áº§u tiÃªn nÃ o Ä‘Ã³ return vá» báº¥t ká»ƒ \(Rejected hay Fulfilled\)
*  **Promise.any** return ngay khi má»™t Promise cÃ³ state Fulfilled báº¥t ká»ƒ cÃ³ nhiá»u Promise sáº½ return vá» Rejected

#### - Promise.race

```javascript
const promiseWillFulfill = [
  new Promise((resolve, reject) => setTimeout(reject, 250, 'ğŸ˜ˆ')),
  new Promise((resolve, reject) => setTimeout(resolve, 150, 'ğŸ˜‡')),
  new Promise((resolve, reject) => setTimeout(resolve, 1, 'ğŸ˜‡')),
]
Promise.race(promiseWillFulfill)
  .then(value => console.log(`The humanity survives "${value}"`))
  .catch(error => console.log(`Won't be called as ğŸ˜‡ will win the race`))



const promiseWillReject = [
  new Promise((resolve, reject) => setTimeout(resolve, 250, 'ğŸ˜‡')),
  new Promise((resolve, reject) => setTimeout(reject, 1, 'ğŸ˜ˆ')),
  new Promise((resolve, reject) => setTimeout(resolve, 250, 'ğŸ˜‡')),
]
Promise.race(promiseWillReject)
  .then(value => console.log(`This won't be called...="${value}"`))
  .catch(error => console.log(`The humanity is doomed...="${error}"`))


const promisesWithOUTReject = [
  new Promise(resolve => setTimeout(resolve, 350, 'one')),
  new Promise(resolve => setTimeout(resolve, 250, 'two')),
  new Promise(resolve => setTimeout(resolve, 150, 'three')),
]
Promise.race(promisesWithOUTReject)
  .then(value => console.log(`Promise without reject="${value}"`))
```

Output:

```javascript
The humanity survives "ğŸ˜‡"
The humanity is doomed...="ğŸ˜ˆ"
Promise without reject="three"
```

#### - Promise.any

```javascript
// Example #1
Promise.any([
    Promise.reject('âœ—'),
    Promise.reject('âœ—'),
    Promise.resolve('âœ“'),
    Promise.reject('âœ—'),
]).then(function(value) {
    console.log(`You win at life`, value)
});

// Example #2
// You get the first fulfilled value
Promise.any([
    new Promise((_, reject) => setTimeout(reject, 10, 'âœ—')),
    new Promise((_, reject) => setTimeout(reject, 20, 'âœ—')),
    new Promise((_, reject) => setTimeout(reject, 30, 'âœ—')),
    new Promise(resolve => setTimeout(resolve, 100, 'I got a job!')),
    new Promise(resolve => setTimeout(resolve, 1000, 'I could have gotten a better job!')),
]).then(function(value) {
    console.log(value)
});

// Example #3
// You get all rejection reasons 
Promise.any([
    Promise.reject('âœ—'),
    Promise.reject('âœ—'),
]).catch(function(reasons) {
    console.log(`Didn't get any offers...`, reasons)
});
```

Output:

```javascript
// Note that the result of Example #3 is printed first because of `setTimeout` in example #2

// Result of Example #1
You win at life âœ“
// Result of Example #3
Didn't get any offers... [ 'âœ—', 'âœ—' ]
// Result of Example #2
I got a job!
```

> LÆ°u Ã½: Hai method má»›i Promise.any vÃ  Promise.allSettled váº«n chÆ°a há»£p lá»‡ trÃªn cÃ¡c trÃ¬nh duyá»‡t

